var app = angular.module('NSAuth', []);



app.service('TokenService', [function() {
  var userToken = 'token'

  this.saveToken = function(token) {
    sessionStorage[userToken] = token;
  }

  this.getToken = function() {
    return sessionStorage[userToken];
  }

  this.removeToken = function() {
    sessionStorage.removeItem(userToken);
  }
}]);



<<<<<<< 5cbaa417e5d177a3ce22f6540ea193105b5ca424
app.service('UserService', ['$http', 'TokenService', function($http, TokenService) {
  var baseUrl = 'http://localhost:9000/auth';

  this.signup = function(user) {
    return $http.post(baseUrl + '/signup', user);
  }

  this.login = function(user) {
    return $http.post(baseUrl + '/login', user).then(function(response) {
      TokenService.saveToken(response.data.token);
      return response;
    });
  }

  this.logout = function() {
    TokenService.removeToken();
  }

  this.isAuthenticated = function() {
    return !!TokenService.getToken();
  }
=======
app.service('UserService', ['$http', 'TokenService', function($http, TokenService) { 
    var baseUrl = 'http://localhost:5000/auth';
	
	this.currentUser = null;
    
    this.signup = function(user) {
        return $http.post(baseUrl + '/signup', user);    
    }
    
    this.login = function(user) {
        return $http.post(baseUrl + '/login', user).then(function(response) {
            TokenService.saveToken(response.data.token);
            return response;
        });
		
    }
    
    this.logout = function() {
        TokenService.removeToken();
		this.currentUser = null;
    }
	
	this.changingUser = function(changeUser) {
		changeUser._id = this.currentUser._id;
		return $http.put('http://localhost:5000/api/user/' + changeUser._id, changeUser).then(function(response) {
			return response;
		});
	}
>>>>>>> adding ability for user info update and a nation.html file
}]);



app.factory('AuthInterceptor', ['$q', '$location' ,'TokenService', function($q, $location, TokenService) {
    var interceptor = {
        request: function(config) {
            var token = TokenService.getToken();
            if (token) {
                config.headers = config.headers || {};
                config.headers.Authorization = 'Bearer ' + token;
            }
            
            return config;
        },
        responseError: function(response) {
            if (response.status === 401) {
                TokenService.removeToken();
                $location.path('/login');
            }
            $q.reject(response);
        }
    }
  }
  return interceptor;
}]);

app.config(['$httpProvider', function($httpProvider) {
  $httpProvider.interceptors.push("AuthInterceptor");
}]);
